#!/usr/bin/env node\n\n/**\n * FiddleBopsæ¸¸æˆå†…å®¹ç¿»è¯‘è„šæœ¬\n * ç”¨äºæ‰¹é‡ç¿»è¯‘æ¸¸æˆmarkdownæ–‡ä»¶åˆ°å¤šç§è¯­è¨€\n */\n\nconst fs = require('fs');\nconst path = require('path');\nconst { execSync } = require('child_process');\n\n// æ”¯æŒçš„è¯­è¨€é…ç½®\nconst LANGUAGES = {\n  zh: 'ç®€ä½“ä¸­æ–‡',\n  es: 'è¥¿ç­ç‰™è¯­',\n  fr: 'æ³•è¯­', \n  de: 'å¾·è¯­',\n  ja: 'æ—¥è¯­',\n  ko: 'éŸ©è¯­'\n};\n\n// è·¯å¾„é…ç½®\nconst GAMES_DIR = path.join(__dirname, '../src/content/games');\nconst EN_DIR = path.join(GAMES_DIR, 'en');\nconst PROMPT_FILE = path.join(__dirname, '../.claude/game-translation-prompt.md');\n\n/**\n * è¯»å–æ¸¸æˆæ–‡ä»¶å†…å®¹\n */\nfunction readGameFile(filePath) {\n  try {\n    return fs.readFileSync(filePath, 'utf8');\n  } catch (error) {\n    console.error(`æ— æ³•è¯»å–æ–‡ä»¶ ${filePath}:`, error.message);\n    return null;\n  }\n}\n\n/**\n * å†™å…¥ç¿»è¯‘åçš„æ¸¸æˆæ–‡ä»¶\n */\nfunction writeGameFile(filePath, content) {\n  try {\n    const dir = path.dirname(filePath);\n    if (!fs.existsSync(dir)) {\n      fs.mkdirSync(dir, { recursive: true });\n    }\n    fs.writeFileSync(filePath, content, 'utf8');\n    console.log(`âœ“ å·²ä¿å­˜: ${filePath}`);\n    return true;\n  } catch (error) {\n    console.error(`æ— æ³•å†™å…¥æ–‡ä»¶ ${filePath}:`, error.message);\n    return false;\n  }\n}\n\n/**\n * ç”ŸæˆClaudeç¿»è¯‘æç¤ºè¯\n */\nfunction generateTranslationPrompt(gameContent, targetLanguage) {\n  const promptTemplate = fs.readFileSync(PROMPT_FILE, 'utf8');\n  return promptTemplate.replace('{TARGET_LANGUAGE}', LANGUAGES[targetLanguage]) + '\\n\\n' + gameContent;\n}\n\n/**\n * è·å–æ‰€æœ‰è‹±æ–‡æ¸¸æˆæ–‡ä»¶\n */\nfunction getEnglishGameFiles() {\n  try {\n    return fs.readdirSync(EN_DIR)\n      .filter(file => file.endsWith('.md'))\n      .map(file => path.join(EN_DIR, file));\n  } catch (error) {\n    console.error('æ— æ³•è¯»å–è‹±æ–‡æ¸¸æˆç›®å½•:', error.message);\n    return [];\n  }\n}\n\n/**\n * æ£€æŸ¥ç¿»è¯‘æ˜¯å¦å·²å­˜åœ¨\n */\nfunction translationExists(gameSlug, locale) {\n  const translatedPath = path.join(GAMES_DIR, locale, `${gameSlug}.md`);\n  return fs.existsSync(translatedPath);\n}\n\n/**\n * ä¸»ç¿»è¯‘å‡½æ•°\n */\nasync function translateGame(gameFile, targetLocale) {\n  const gameSlug = path.basename(gameFile, '.md');\n  \n  // æ£€æŸ¥ç¿»è¯‘æ˜¯å¦å·²å­˜åœ¨\n  if (translationExists(gameSlug, targetLocale)) {\n    console.log(`â­ è·³è¿‡ ${gameSlug} (${targetLocale}) - ç¿»è¯‘å·²å­˜åœ¨`);\n    return true;\n  }\n  \n  // è¯»å–åŸå§‹å†…å®¹\n  const originalContent = readGameFile(gameFile);\n  if (!originalContent) {\n    return false;\n  }\n  \n  // ç”Ÿæˆç¿»è¯‘æç¤ºè¯\n  const translationPrompt = generateTranslationPrompt(originalContent, targetLocale);\n  \n  console.log(`\\nğŸ”„ å‡†å¤‡ç¿»è¯‘: ${gameSlug} -> ${LANGUAGES[targetLocale]}`);\n  console.log('ğŸ“ ç¿»è¯‘æç¤ºè¯å·²å‡†å¤‡å¥½ï¼Œè¯·å°†ä»¥ä¸‹å†…å®¹ç²˜è´´åˆ°Claude:');\n  console.log('=' * 80);\n  console.log(translationPrompt);\n  console.log('=' * 80);\n  \n  // ç­‰å¾…ç”¨æˆ·è¾“å…¥ç¿»è¯‘ç»“æœ\n  const readline = require('readline');\n  const rl = readline.createInterface({\n    input: process.stdin,\n    output: process.stdout\n  });\n  \n  return new Promise((resolve) => {\n    rl.question('\\nè¯·ç²˜è´´Claudeçš„ç¿»è¯‘ç»“æœï¼ˆå®Œæ•´çš„markdownæ–‡ä»¶å†…å®¹ï¼‰ï¼Œç„¶åæŒ‰å›è½¦ï¼š\\n', (translatedContent) => {\n      rl.close();\n      \n      if (translatedContent.trim()) {\n        const outputPath = path.join(GAMES_DIR, targetLocale, `${gameSlug}.md`);\n        const success = writeGameFile(outputPath, translatedContent.trim());\n        resolve(success);\n      } else {\n        console.log('âŒ æœªè¾“å…¥ç¿»è¯‘å†…å®¹ï¼Œè·³è¿‡æ­¤æ–‡ä»¶');\n        resolve(false);\n      }\n    });\n  });\n}\n\n/**\n * æ‰¹é‡ç¿»è¯‘æ¸¸æˆ\n */\nasync function batchTranslate(targetLocale = null, gameSlug = null) {\n  console.log('ğŸš€ FiddleBopsæ¸¸æˆç¿»è¯‘è„šæœ¬å¯åŠ¨\\n');\n  \n  let gameFiles = [];\n  \n  if (gameSlug) {\n    // ç¿»è¯‘å•ä¸ªæ¸¸æˆ\n    const singleGameFile = path.join(EN_DIR, `${gameSlug}.md`);\n    if (fs.existsSync(singleGameFile)) {\n      gameFiles = [singleGameFile];\n    } else {\n      console.error(`âŒ æ¸¸æˆæ–‡ä»¶ä¸å­˜åœ¨: ${singleGameFile}`);\n      return;\n    }\n  } else {\n    // ç¿»è¯‘æ‰€æœ‰æ¸¸æˆ\n    gameFiles = getEnglishGameFiles();\n  }\n  \n  const targetLocales = targetLocale ? [targetLocale] : Object.keys(LANGUAGES);\n  \n  console.log(`ğŸ“Š ç¿»è¯‘ç»Ÿè®¡:`);\n  console.log(`   æ¸¸æˆæ•°é‡: ${gameFiles.length}`);\n  console.log(`   ç›®æ ‡è¯­è¨€: ${targetLocales.map(l => LANGUAGES[l]).join(', ')}`);\n  console.log(`   é¢„ä¼°ä»»åŠ¡: ${gameFiles.length * targetLocales.length}\\n`);\n  \n  let successCount = 0;\n  let totalCount = 0;\n  \n  for (const gameFile of gameFiles) {\n    for (const locale of targetLocales) {\n      totalCount++;\n      const success = await translateGame(gameFile, locale);\n      if (success) {\n        successCount++;\n      }\n    }\n  }\n  \n  console.log(`\\nğŸ‰ ç¿»è¯‘å®Œæˆï¼`);\n  console.log(`   æˆåŠŸ: ${successCount}/${totalCount}`);\n  console.log(`   å¤±è´¥: ${totalCount - successCount}/${totalCount}`);\n}\n\n// å‘½ä»¤è¡Œå‚æ•°å¤„ç†\nconst args = process.argv.slice(2);\nconst targetLocale = args[0] && Object.keys(LANGUAGES).includes(args[0]) ? args[0] : null;\nconst gameSlug = args[1] || null;\n\nif (args.length === 0) {\n  console.log('ä½¿ç”¨æ–¹æ³•:');\n  console.log('  node translate-games.js [è¯­è¨€ä»£ç ] [æ¸¸æˆslug]');\n  console.log('  ');\n  console.log('ç¤ºä¾‹:');\n  console.log('  node translate-games.js zh              # ç¿»è¯‘æ‰€æœ‰æ¸¸æˆåˆ°ä¸­æ–‡');\n  console.log('  node translate-games.js zh sprunki-retake  # ç¿»è¯‘å•ä¸ªæ¸¸æˆåˆ°ä¸­æ–‡');\n  console.log('  node translate-games.js                 # ç¿»è¯‘æ‰€æœ‰æ¸¸æˆåˆ°æ‰€æœ‰è¯­è¨€');\n  console.log('');\n  console.log('æ”¯æŒçš„è¯­è¨€ä»£ç :', Object.keys(LANGUAGES).join(', '));\n  process.exit(0);\n}\n\n// å¯åŠ¨ç¿»è¯‘\nbatchTranslate(targetLocale, gameSlug).catch(error => {\n  console.error('âŒ ç¿»è¯‘è„šæœ¬æ‰§è¡Œå¤±è´¥:', error.message);\n  process.exit(1);\n});