---
/**
 * Dynamic Game Page using Content Collection
 * Refactored to use GameLayout component
 * 
 * Requirements: 2.4 - Uses GameLayout component with correct props
 */
import { getCollection, type CollectionEntry } from 'astro:content';
import GameLayout from '../layouts/GameLayout.astro';

type Props = {
  game: CollectionEntry<'games'>;
};

export async function getStaticPaths() {
  const allGames = await getCollection('games');

  const paths = allGames.map(game => {
    const legacySlug = game.data.urlstr ?? game.slug;

    return {
      params: {
        gameSlug: legacySlug,
      },
      props: {
        game,
      },
    };
  });

  return paths;
}

const { game } = Astro.props as Props;
const { title, description, iframeSrc, tags, thumbnail, score } = game.data;
const { Content } = await game.render();
---

<GameLayout
  title={title}
  description={description}
  canonicalUrl={Astro.url.href}
  thumbnail={thumbnail}
  iframeSrc={iframeSrc}
  score={score}
  tags={tags}
>
  <Content />
</GameLayout>
