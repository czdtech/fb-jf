---
import type { CollectionEntry } from 'astro:content';
import GameLayout from '../../layouts/GameLayout.astro';
import { getGameHreflang } from '../../data/hreflang';

export { getStaticPaths } from '../[gameSlug].astro';

type Props = {
  game: CollectionEntry<'games'>;
  localeMap: Record<string, CollectionEntry<'games'>>;
};

const { game: defaultGame, localeMap } = Astro.props as Props;
const legacySlug = defaultGame.data.urlstr ?? defaultGame.slug;
const canonicalUrl = `https://www.playfiddlebops.com/de/${legacySlug}/`;
const hreflangLinks = getGameHreflang(legacySlug);

// Use pre-computed locale map instead of re-querying the collection
const localizedGame = localeMap['de'] ?? defaultGame;

const { title, description, iframeSrc, tags, thumbnail, score } = localizedGame.data;
const { Content } = await localizedGame.render();
---
<GameLayout
  title={title}
  description={description}
  canonicalUrl={canonicalUrl}
  thumbnail={thumbnail}
  iframeSrc={iframeSrc}
  score={score}
  tags={tags}
  slug={legacySlug}
  lang="de"
  hreflangLinks={hreflangLinks}
>
  <Content />
</GameLayout>
