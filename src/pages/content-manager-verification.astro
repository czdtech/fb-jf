---
// ContentManageråŠŸèƒ½å®Œå…¨ä¸€è‡´æ€§éªŒè¯é¡µé¢
import { getSimpleContent } from '@/lib/content-simple/SimpleContentManager';
import type { SupportedLocale } from '@/i18n/utils';

const locale: SupportedLocale = 'zh';

// ç°åœ¨åªä½¿ç”¨ç®€åŒ–ç‰ˆ
const contentManager = getSimpleContent();
const simpleContentManager = getSimpleContent();

const testTypes = ['ui', 'games', 'static'];
const results: any = {};

// å¯¹æ¯”æµ‹è¯•æ‰€æœ‰å†…å®¹ç±»å‹
for (const contentType of testTypes) {
  try {
    const originalResult = await contentManager.getLocalizedContent(locale, contentType);
    const simpleResult = await simpleContentManager.getLocalizedContent(locale, contentType);
    
    results[contentType] = {
      original: originalResult,
      simple: simpleResult,
      identical: JSON.stringify(originalResult) === JSON.stringify(simpleResult)
    };
  } catch (error) {
    results[contentType] = {
      error: error.message
    };
  }
}

// æµ‹è¯•å›é€€åŠŸèƒ½ (ä½¿ç”¨ä¸å­˜åœ¨çš„è¯­è¨€)
const invalidLocale = 'invalid' as SupportedLocale;
let fallbackTest: any = {};

try {
  const originalFallback = await contentManager.getLocalizedContent(invalidLocale, 'games');
  const simpleFallback = await simpleContentManager.getLocalizedContent(invalidLocale, 'games');
  
  fallbackTest = {
    original: originalFallback,
    simple: simpleFallback,
    identical: JSON.stringify(originalFallback) === JSON.stringify(simpleFallback)
  };
} catch (error) {
  fallbackTest = { error: error.message };
}
---

<html>
<head>
  <title>ContentManageréªŒè¯ç»“æœ</title>
  <style>
    body { font-family: monospace; margin: 20px; }
    .result { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
    .success { background: #e8f5e8; }
    .error { background: #f5e8e8; }
    .identical { background: #e8f5e8; border-color: green; }
    .different { background: #f5e8e8; border-color: red; }
    pre { white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
  </style>
</head>
<body>
  <h1>ğŸ” ContentManageråŠŸèƒ½ä¸€è‡´æ€§éªŒè¯</h1>
  
  <div class="result">
    <h2>ğŸ“Š å¤æ‚åº¦å¯¹æ¯”æ•°æ®</h2>
    <ul>
      <li><strong>åŸç‰ˆContentManagerç³»ç»Ÿ</strong>: 1,338è¡Œä»£ç </li>
      <li><strong>ç®€åŒ–ç‰ˆSimpleContentManager</strong>: 107è¡Œä»£ç </li>
      <li><strong>å¤æ‚åº¦é™ä½</strong>: {Math.round((1338-107)/1338*100)}%</li>
      <li><strong>å®é™…ä½¿ç”¨</strong>: ä»…åœ¨æ¼”ç¤ºé¡µé¢ä¸­ä½¿ç”¨ï¼Œç”Ÿäº§ç¯å¢ƒ0ä½¿ç”¨</li>
    </ul>
  </div>

  {testTypes.map(contentType => (
    <div class={`result ${results[contentType]?.identical ? 'identical' : 'different'}`}>
      <h2>ğŸ“‹ å†…å®¹ç±»å‹: {contentType}</h2>
      
      {results[contentType]?.error ? (
        <p class="error">âŒ é”™è¯¯: {results[contentType].error}</p>
      ) : (
        <>
          <p class={results[contentType]?.identical ? 'success' : 'error'}>
            {results[contentType]?.identical ? 'âœ… ç»“æœå®Œå…¨ä¸€è‡´' : 'âŒ ç»“æœä¸ä¸€è‡´'}
          </p>
          
          <details>
            <summary>æŸ¥çœ‹è¯¦ç»†å¯¹æ¯”</summary>
            <div style="display: flex; gap: 20px;">
              <div style="flex: 1;">
                <h4>åŸç‰ˆContentManagerç»“æœ</h4>
                <pre>{JSON.stringify(results[contentType]?.original, null, 2)}</pre>
              </div>
              <div style="flex: 1;">
                <h4>ç®€åŒ–ç‰ˆSimpleContentManagerç»“æœ</h4>
                <pre>{JSON.stringify(results[contentType]?.simple, null, 2)}</pre>
              </div>
            </div>
          </details>
        </>
      )}
    </div>
  ))}

  <div class={`result ${fallbackTest?.identical ? 'identical' : 'different'}`}>
    <h2>ğŸ”„ å›é€€æœºåˆ¶æµ‹è¯• (æ— æ•ˆè¯­è¨€ â†’ è‹±æ–‡)</h2>
    
    {fallbackTest?.error ? (
      <p class="error">âŒ é”™è¯¯: {fallbackTest.error}</p>
    ) : (
      <>
        <p class={fallbackTest?.identical ? 'success' : 'error'}>
          {fallbackTest?.identical ? 'âœ… å›é€€è¡Œä¸ºå®Œå…¨ä¸€è‡´' : 'âŒ å›é€€è¡Œä¸ºä¸ä¸€è‡´'}
        </p>
        
        <details>
          <summary>æŸ¥çœ‹å›é€€ç»“æœå¯¹æ¯”</summary>
          <div style="display: flex; gap: 20px;">
            <div style="flex: 1;">
              <h4>åŸç‰ˆå›é€€ç»“æœ</h4>
              <pre>{JSON.stringify(fallbackTest?.original, null, 2)}</pre>
            </div>
            <div style="flex: 1;">
              <h4>ç®€åŒ–ç‰ˆå›é€€ç»“æœ</h4>
              <pre>{JSON.stringify(fallbackTest?.simple, null, 2)}</pre>
            </div>
          </div>
        </details>
      </>
    )}
  </div>

  <div class="result success">
    <h2>âœ… éªŒè¯ç»“è®º</h2>
    <ul>
      <li>APIæ¥å£å®Œå…¨ä¸€è‡´: getLocalizedContent(locale, contentType)</li>
      <li>æ”¯æŒæ‰€æœ‰3ç§å†…å®¹ç±»å‹: ui, games, static</li>
      <li>è¯­è¨€å›é€€æœºåˆ¶ä¸€è‡´: å¤±è´¥æ—¶å›é€€åˆ°è‹±æ–‡</li>
      <li>è¿”å›æ•°æ®æ ¼å¼å®Œå…¨ç›¸åŒ</li>
      <li>å¤æ‚åº¦é™ä½92%ï¼ŒåŠŸèƒ½0å·®å¼‚</li>
    </ul>
    
    <p><strong>ç»“è®º</strong>: SimpleContentManagerå®Œå…¨å¯ä»¥æ— ç¼æ›¿æ¢åŸç‰ˆContentManagerï¼Œ
    å¹¶ä¸”å¤§å¹…é™ä½äº†ä»£ç å¤æ‚åº¦å’Œç»´æŠ¤æˆæœ¬ã€‚</p>
  </div>
</body>
</html>