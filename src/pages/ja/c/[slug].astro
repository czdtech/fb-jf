---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import CATEGORIES from '../../../components/Categories.astro';
import { getCategoryHreflang } from '../../../data/hreflang';
import { toGameCardData, type GameEntry } from '../../../lib/canonical-games';
import { buildCategorySeoTitle } from '../../../lib/seo-title';

export { getStaticPaths } from '../../c/[slug].astro';

type Props = {
  games: GameEntry[];
  tagName: string;
};

const { games, tagName } = Astro.props as Props;
const locale = 'ja';
const slug = Astro.params.slug!;
const hreflangLinks = getCategoryHreflang(slug);

const displayTagName = tagName
  .split(' ')
  .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
  .join(' ');

const gameCount = games.length;
const description = `FiddleBops Game World で ${gameCount} 個の ${displayTagName} ゲームを無料でオンラインプレイできます。人気作 ${games
  .slice(0, 3)
  .map((g) => toGameCardData(g, locale).title)
  .join('、')} など。`;
const title = buildCategorySeoTitle(locale, displayTagName);
const canonicalUrl = `https://www.playfiddlebops.com/ja/c/${slug}/`;

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'ItemList',
  name: title,
  description,
  url: canonicalUrl,
  itemListElement: games.map((game, index) => {
    const card = toGameCardData(game, locale);
    return {
      '@type': 'ListItem',
      position: index + 1,
      url: `https://www.playfiddlebops.com${card.href}`,
    };
  }),
};
---
<BaseLayout
  title={title}
  description={description}
  canonicalUrl={canonicalUrl}
  jsonLd={jsonLd}
  hreflangLinks={hreflangLinks}
  lang="ja"
>
  <section class="games">
    <div class="container">
      <h1>{displayTagName} ゲーム</h1>
      <p>
        全 {gameCount} 個の {displayTagName} 系ゲームをブラウザで今すぐ無料プレイ。
      </p>
      <div class="game-grid">
        {games.map((game) => {
          const card = toGameCardData(game, locale);
          return (
            <article class="game">
              <a href={card.href}>
                <div class="game-logo">
                  <img
                    src={card.thumbnail}
                    alt={card.title}
                    loading="lazy"
                    width="300"
                    height="300"
                  />
                </div>
                <p>{card.title}</p>
              </a>
            </article>
          );
        })}
      </div>
    </div>
  </section>

  <CATEGORIES lang="ja" />
</BaseLayout>
