---
// ç¤ºä¾‹ï¼šåœ¨Astroé¡µé¢ä¸­ä½¿ç”¨æ–°çš„å†…å®¹ç®¡ç†ç³»ç»Ÿ
import { getSimpleContent } from '@/lib/content-simple/SimpleContentManager';
import { getCurrentLocale } from '@/i18n/utils';

// è·å–å½“å‰è¯­è¨€
const currentLocale = getCurrentLocale(Astro.url);

// åˆå§‹åŒ–å†…å®¹ç®¡ç†å™¨
const contentManager = getSimpleContent();

try {
  // ä½¿ç”¨æ–°çš„å†…å®¹ç®¡ç†ç³»ç»Ÿè·å–UIç¿»è¯‘
  const uiContent = await contentManager.getLocalizedContent(currentLocale, 'ui');
  const translations = uiContent.ui || {};
  
  // è·å–é™æ€æ•°æ®
  const staticContent = await contentManager.getLocalizedContent(currentLocale, 'static');
  const staticData = staticContent.staticData || {};
  
  // è·å–æ¸¸æˆåˆ—è¡¨
  const gamesContent = await contentManager.getLocalizedContent(currentLocale, 'games');
  const games = gamesContent.games || [];

  console.log('ğŸ“Š Content loaded successfully:', {
    locale: currentLocale,
    uiKeys: Object.keys(translations).length,
    staticSections: Object.keys(staticData).length,
    gameCount: games.length,
    fallbackUsed: uiContent.meta?.fallbackUsed || false
  });

} catch (error) {
  console.error('âŒ Failed to load content:', error);
}
---

<!DOCTYPE html>
<html lang={currentLocale}>
<head>
  <meta charset="utf-8" />
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <meta name="viewport" content="width=device-width" />
  <title>Content Management System Demo</title>
</head>
<body>
  <div class="container mx-auto py-8">
    <h1 class="text-3xl font-bold mb-6">FiddleBops Content Management System</h1>
    
    <div class="grid gap-6">
      <section class="bg-gray-100 p-4 rounded-lg">
        <h2 class="text-xl font-semibold mb-3">âœ… Implementation Completed</h2>
        <ul class="space-y-2">
          <li>ğŸ—ï¸ Unified Content Management Interface (ContentManager.ts)</li>
          <li>ğŸ”Œ Content Adapters (UI, Games, Static Data)</li>
          <li>ğŸ“ migrated extracted-data.json to Content Collections</li>
          <li>ğŸ·ï¸ Automatic TypeScript type generation</li>
          <li>ğŸ”„ Multi-level fallback strategy</li>
          <li>âœ… Content validation system</li>
        </ul>
      </section>

      <section class="bg-blue-50 p-4 rounded-lg">
        <h2 class="text-xl font-semibold mb-3">ğŸš€ Available Commands</h2>
        <div class="space-y-1 font-mono text-sm">
          <div><code>npm run content:validate</code> - Validate all content</div>
          <div><code>npm run content:types</code> - Generate TypeScript types</div>
          <div><code>npm run content:coverage</code> - Generate coverage report</div>
          <div><code>npm run content:sync</code> - Sync types and validate</div>
        </div>
      </section>

      <section class="bg-green-50 p-4 rounded-lg">
        <h2 class="text-xl font-semibold mb-3">ğŸ“ˆ System Benefits</h2>
        <ul class="space-y-1">
          <li>â€¢ Unified content access layer</li>
          <li>â€¢ Automatic type safety</li>
          <li>â€¢ Smart fallback mechanisms</li>
          <li>â€¢ Runtime content validation</li>
          <li>â€¢ Performance caching</li>
          <li>â€¢ Build-time error detection</li>
        </ul>
      </section>

      <section class="bg-yellow-50 p-4 rounded-lg">
        <h2 class="text-xl font-semibold mb-3">ğŸ”§ File Structure Created</h2>
        <pre class="text-xs bg-white p-2 rounded overflow-x-auto"><code>src/
â”œâ”€â”€ lib/content/
â”‚   â”œâ”€â”€ ContentManager.ts         # Core content management
â”‚   â”œâ”€â”€ FallbackStrategy.ts       # Multi-level fallbacks  
â”‚   â”œâ”€â”€ adapters/
â”‚   â”‚   â”œâ”€â”€ UIContentAdapter.ts   # UI translations
â”‚   â”‚   â”œâ”€â”€ GameContentAdapter.ts # Game content
â”‚   â”‚   â””â”€â”€ StaticDataAdapter.ts  # Static data
â”‚   â””â”€â”€ index.ts                  # Public API
â”œâ”€â”€ content/
â”‚   â”œâ”€â”€ staticData/              # New: Static data collections
â”‚   â”‚   â””â”€â”€ en.json              # Migrated extracted-data
â”‚   â”œâ”€â”€ i18nUI/                  # Existing UI translations
â”‚   â””â”€â”€ games/                   # Existing game content
scripts/
â”œâ”€â”€ generate-content-types.ts    # Type generator
â””â”€â”€ validate-content.ts          # Content validator</code></pre>
      </section>
    </div>
  </div>
</body>
</html>