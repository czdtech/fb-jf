---
import BaseLayout from '@/layouts/BaseLayout.astro'
import Navigation from '@/components/Navigation.astro'
import Footer from '@/components/Footer.astro'
import GamesList from '@/components/GamesList.astro'
import { getLocalizedGamesList } from '@/utils/i18n'
import { getTranslation, type SupportedLocale } from '@/i18n/utils'
import { getAbsoluteLocaleUrl } from 'astro:i18n'

const locale: SupportedLocale = 'fr'
const translation = await getTranslation(locale)
const uiText = translation.ui
const localizedGames = await getLocalizedGamesList(locale)

const popularGameSlugs = ['sprunki-red-sun', 'sprunki-abgerny', 'sprunki-sonic']
const popularGames = localizedGames.filter((g: any) => popularGameSlugs.includes(g.slug))
const featureGame = { slug: '', data: { title: 'Fiddlebops', image: '/tw.jpg', category: 'Music', description: 'Fiddlebops' } }
const displayGames = [...popularGames, featureGame]

const pageMeta = {
  title: `${uiText?.sections?.popularGames || 'Popular Games'} - Fiddlebops`,
  description: uiText?.meta?.description || 'Jeux Fiddlebops populaires.',
  keywords: uiText?.meta?.keywords || 'fiddlebops, jeux de musique',
  canonical: getAbsoluteLocaleUrl(locale, '/popular-games'),
  ogImage: 'https://www.playfiddlebops.com/tw.jpg'
}
---

<BaseLayout meta={pageMeta} lang={locale}>
  <Navigation locale={locale} currentPath={`/${locale}/popular-games/`} />
  <main class="popular-games-page">
    <div class="responsive-container container-standard">
      <div class="page-header">
        <h1>â–¶ {uiText?.sections?.popularGames || 'Popular Games'}</h1>
        <p>{uiText?.sections?.about || 'Discover the most loved games'}</p>
      </div>
      <div class="game-iframe-pop"><GamesList games={displayGames} variant="simple" /></div>
      <div class="more-games-section">
        <h2>{uiText?.sections?.popularGames || 'Popular Games'}</h2>
        <GamesList games={localizedGames.slice(0, 12)} variant="grid" />
      </div>
    </div>
  </main>
  <Footer locale={locale} />
</BaseLayout>

<style>
  .popular-games-page { min-height: calc(100vh - 160px); padding: var(--space-8) 0; }
  .page-header { text-align: center; margin-bottom: var(--space-12); }
  .page-header h1 { font-size: var(--font-size-4xl); font-weight: var(--font-weight-bold); color: var(--color-gray-900); margin-bottom: var(--space-4); }
  .page-header p { font-size: var(--font-size-xl); color: var(--color-gray-600); }
  .game-iframe-pop { background: var(--color-white); border-radius: var(--border-radius-xl); padding: var(--space-8); box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: var(--space-12); }
  .more-games-section { margin-top: var(--space-16); }
  .more-games-section h2 { font-size: var(--font-size-3xl); font-weight: var(--font-weight-bold); text-align: center; margin-bottom: var(--space-8); color: var(--color-gray-900); }
  @media (max-width: 768px) { .page-header h1 { font-size: var(--font-size-3xl); } .page-header p { font-size: var(--font-size-lg); } .game-iframe-pop { padding: var(--space-6); } }
</style>

