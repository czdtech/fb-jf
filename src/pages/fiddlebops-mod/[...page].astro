---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { FIDDLEBOPS_MOD_HREFLANG } from '../../data/hreflang';
import { getCanonicalGames, type GameEntry } from '../../lib/canonical-games';

export async function getStaticPaths({ paginate }) {
  const canonicalGames = await getCanonicalGames();

  const getSlug = (entry: GameEntry): string =>
    String(entry.data.urlstr || entry.slug).replace(/^\/+/, '').replace(/\/+$/, '');

  const getTitle = (entry: GameEntry): string => {
    const title = entry.data.title || 'Untitled';
    return title.split(' - ')[0] || title;
  };

  const modGames = canonicalGames.filter((game) => game.data.modType === 'fiddlebops');

  const astronautPages = modGames.map((game) => ({
    astronaut: [`/${getSlug(game)}/`, game.data.thumbnail, getTitle(game)],
  }));

  // 根据数据动态分页（保持原先 pageSize=30）
  return paginate(astronautPages, { pageSize: 30 });
}

// 所有分页数据都在 "page" 参数中传递
const { page } = Astro.props;
const title = 'Fiddlebops Mod - FiddleBops Game World';
const description =
  'Create your unique music with FiddleBops! This fan-made project, inspired by Incredibox, lets you mix and match various sounds to compose personalized tracks.';
const canonicalUrl = 'https://www.playfiddlebops.com/fiddlebops-mod/';
const ogImage = 'https://www.playfiddlebops.com/tw.jpg';
const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Game',
  name: title,
  alternateName: 'playfiddlebops.com',
  url: canonicalUrl,
  description
};
---
<BaseLayout
  title={title}
  description={description}
  canonicalUrl={canonicalUrl}
  ogImage={ogImage}
  ogType="website"
  twitterCard="summary_large_image"
  jsonLd={jsonLd}
  hreflangLinks={FIDDLEBOPS_MOD_HREFLANG}
  lang="en"
>
  <section class="games">
    <div class="container">
      <h1>Fiddlebops Mod</h1>
      <p>
        Explore Fiddlebops-inspired mods and remixes. Play online for free with no download required.
      </p>

      <div class="game-grid">
        {page.data.map(({ astronaut }) => {
          const [href, thumbnail, gameTitle] = astronaut;

          return (
            <article class="game">
              <a href={href} title={gameTitle}>
                <div class="game-logo game-l-2">
                  <img src={thumbnail} alt={gameTitle} loading="lazy" width="300" height="300" />
                  <div class="game-overlay">
                    <p>{gameTitle}</p>
                  </div>
                </div>
              </a>
            </article>
          );
        })}
      </div>

      <div class="pagination">
        {page.url.prev && <a href={page.url.prev}>«</a>}
        <b class="current">
          {page.currentPage} / {page.lastPage}
        </b>
        {page.url.next && <a href={page.url.next}>»</a>}
      </div>
    </div>
  </section>
</BaseLayout>
