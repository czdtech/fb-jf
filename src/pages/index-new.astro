---
import BaseLayout from '@/layouts/BaseLayout.astro'
import Header from '@/components/Header.astro'
import Footer from '@/components/Footer.astro'
import GameCard from '@/components/GameCard.astro'
import GameIframe from '@/components/GameIframe.astro'
import SoundSample from '@/components/SoundSample.astro'

// å¯¼å…¥Sectionç»„ä»¶
import HeroSection from '@/components/sections/HeroSection.astro'
import HowToPlaySection from '@/components/sections/HowToPlaySection.astro'
import AboutSection from '@/components/sections/AboutSection.astro'
import SoundSamplesSection from '@/components/sections/SoundSamplesSection.astro'
import VideosSection from '@/components/sections/VideosSection.astro'
import FAQSection from '@/components/sections/FAQSection.astro'
import CommentsSection from '@/components/sections/CommentsSection.astro'

// Heroè®¾è®¡ç³»ç»Ÿå·²æ•´åˆè‡³ components.css

// å¯¼å…¥æ•°æ®
import extractedData from '@/data/extracted-data.json'

const { navigation, homepage, games, seoTemplates } = extractedData

// å¤šè¯­è¨€é…ç½®
const hreflangLinks = navigation.languages.map((lang: any) => ({
  code: lang.code === 'en' ? 'x-default' : lang.code,
  url: `https://www.playfiddlebops.com${lang.url}`,
  label: lang.label,
}))

// ç»“æ„åŒ–æ•°æ®
const structuredData = {
  '@context': 'https://schema.org',
  '@type': 'Game',
  name: homepage.meta.title,
  alternateName: 'playfiddlebops.com',
  url: homepage.meta.canonical,
  description: homepage.meta.description,
}
---

<BaseLayout
  meta={homepage.meta}
  lang="en"
  hreflang={hreflangLinks}
  structuredData={structuredData}
>
  <Header
    navigation={navigation.main}
    languages={navigation.languages}
    currentLang="en"
    currentPath="/"
  />

  <main>
    <!-- Hero Section -->
    <HeroSection hero={homepage.hero} games={games} />

    <!-- How to Play Section -->
    <HowToPlaySection />

    <!-- About Section -->
    <AboutSection />

    <!-- Sound Samples Section -->
    <SoundSamplesSection soundSamples={homepage.soundSamples} />

    <!-- Video Section -->
    <VideosSection />

    <!-- FAQ Section -->
    <FAQSection />

    <!-- Comments Section -->
    <CommentsSection />
  </main>

  <Footer />
</BaseLayout>

<!-- å¼•å…¥äº¤äº’ç³»ç»Ÿ -->
<script>
  import '@/scripts/interactions.js'
</script>

<!-- éŸ³ç¬¦ç‚¹å‡»åŠ¨ç”» -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const musicNotes = ['â™ª', 'â™«', 'â™¬', 'â™©', 'â™­', 'â™¯', 'ğ„']

    function createNote(x: number, y: number) {
      const note = document.createElement('div')
      const randomNote =
        musicNotes[Math.floor(Math.random() * musicNotes.length)]
      note.textContent = randomNote
      note.className = 'click-note'

      // éšæœºé¢œè‰²ï¼ˆç´«è‰²ç³»ï¼‰
      const colors = ['#9333ea', '#a855f7', '#c084fc', '#ec4899', '#f472b6']
      const randomColor = colors[Math.floor(Math.random() * colors.length)]

      // è®¾ç½®æ ·å¼
      note.style.cssText = `
      position: fixed;
      left: ${x}px;
      top: ${y}px;
      color: ${randomColor};
      font-size: ${Math.random() * 8 + 16}px;
      font-weight: bold;
      pointer-events: none;
      z-index: 9999;
      user-select: none;
      transform: translate(-50%, -50%) rotate(${Math.random() * 30 - 15}deg);
    `

      document.body.appendChild(note)

      // åŠ¨ç”»
      const animation = note.animate(
        [
          {
            opacity: 1,
            transform: `translate(-50%, -50%) rotate(${Math.random() * 30 - 15}deg) scale(1)`,
            filter: 'blur(0px)',
          },
          {
            opacity: 0.7,
            transform: `translate(-50%, -150%) rotate(${Math.random() * 60 - 30}deg) scale(1.2)`,
            filter: 'blur(0px)',
          },
          {
            opacity: 0,
            transform: `translate(-50%, -200%) rotate(${Math.random() * 90 - 45}deg) scale(0.8)`,
            filter: 'blur(2px)',
          },
        ],
        {
          duration: 1200,
          easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)',
        }
      )

      animation.onfinish = () => {
        if (note.parentNode) {
          note.parentNode.removeChild(note)
        }
      }
    }

    // ç‚¹å‡»äº‹ä»¶ç›‘å¬ï¼ˆå¸¦èŠ‚æµï¼‰- å…¨å±€éŸ³ç¬¦æ•ˆæœ
    let lastClick = 0
    document.body.addEventListener('click', function (e) {
      const now = Date.now()
      if (now - lastClick < 200) return
      lastClick = now

      // åˆ›å»º1-3ä¸ªéŸ³ç¬¦ï¼ˆåœ¨æ‰€æœ‰åœ°æ–¹éƒ½åˆ›å»ºç‚¹å‡»ä½ç½®éŸ³ç¬¦ï¼‰
      const noteCount = Math.floor(Math.random() * 3) + 1

      for (let i = 0; i < noteCount; i++) {
        setTimeout(() => {
          const offsetX = (Math.random() - 0.5) * 40
          const offsetY = (Math.random() - 0.5) * 40
          createNote(e.clientX + offsetX, e.clientY + offsetY)
        }, i * 100)
      }
    })
  })
</script>

<style>
  /* ==========================================================================
   é¦–é¡µç‰¹å®šæ ·å¼ - åŸºäºæ–°è®¾è®¡ç³»ç»Ÿ
   ========================================================================== */

  /* ==========================================================================
   ç»Ÿä¸€é¡µé¢èƒŒæ™¯
   ========================================================================== */

  body {
    /* åº”ç”¨HeroèƒŒæ™¯è®¾è®¡åˆ°æ•´ä¸ªé¡µé¢ */
    background: var(--hero-main-bg);
    min-height: 100vh;
    position: relative;
  }

  body::before {
    /* é¡µé¢çº§è£…é¥°çº¹ç† */
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--hero-texture-bg);
    opacity: var(--hero-texture-opacity);
    pointer-events: none;
    z-index: -1;
  }

  /* ==========================================================================
   ç®€æ´å“åº”å¼è®¾è®¡ - æ¸¸æˆç½‘ç«™ä¸“ç”¨
   ========================================================================== */

  /* é˜²æ­¢å­—ä½“åŠ è½½è·³åŠ¨ */
  * {
    font-display: swap;
  }

  /* å›¾ç‰‡é¢„è®¾å°ºå¯¸é˜²æ­¢å¸ƒå±€åç§» */
  img {
    max-width: 100%;
    height: auto;
  }

  .game-iframe-container img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* åŠ¨ç”»å¢å¼º */
  .music-element:hover {
    animation: none !important;
  }

  .scroll-animate {
    opacity: 0;
    transform: translateY(30px);
    transition: all var(--duration-700) var(--ease-out);
  }

  .scroll-animate.animate {
    opacity: 1;
    transform: translateY(0);
  }
</style>
