---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { getPagedListHreflang } from '../../../data/hreflang';
import { toGameCardData } from '../../../lib/canonical-games';
import { buildListSeoTitle } from '../../../lib/seo-title';
export { getStaticPaths } from '../../update-games/[...page].astro';

// 所有分页数据都在 "page" 参数中传递
const { page } = Astro.props;
const hreflangLinks = getPagedListHreflang('/update-games/', page.currentPage);
const locale = 'zh';
const baseTitle = '最新游戏';
const title = buildListSeoTitle(locale, baseTitle, page.currentPage);
const description =
  '在 FiddleBops 游戏世界中查看最新上线的小游戏，包括休闲、益智、音乐等多种类型，在线免费畅玩，无需下载。';
// canonical 使用当前页面自身 URL
const canonicalUrl = new URL(Astro.url.pathname, Astro.site).toString();
const ogImage = 'https://www.playfiddlebops.com/tw.jpg';
const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Game',
  name: baseTitle,
  alternateName: 'playfiddlebops.com',
  url: canonicalUrl,
  description
};
---
<BaseLayout
  title={title}
  description={description}
  canonicalUrl={canonicalUrl}
  ogImage={ogImage}
  ogType="website"
  twitterCard="summary_large_image"
  jsonLd={jsonLd}
  hreflangLinks={hreflangLinks}
  lang="zh-CN"
>
  <section class="games">
    <div class="container">
      <h1>最新游戏</h1>
      <p>
        这里是 FiddleBops 最近更新和新上线的游戏合集，随时发现最新玩法。
      </p>

      <div class="game-grid">
        {page.data.map((entry) => {
          const card = toGameCardData(entry, locale);
          return (
            <article class="game">
              <a href={card.href} title={card.title}>
                <div class="game-logo">
                  <img src={card.thumbnail} alt={card.title} loading="lazy" width="300" height="300" />
                </div>
                <p>{card.title}</p>
              </a>
            </article>
          );
        })}
      </div>

      <div class="pagination">
        {page.url.prev && <a href={page.url.prev}>«</a>}
        <b class="current">
          {page.currentPage} / {page.lastPage}
        </b>
        {page.url.next && <a href={page.url.next}>»</a>}
      </div>
    </div>
  </section>
</BaseLayout>
