---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import CATEGORIES from '../../../components/Categories.astro';
import type { CollectionEntry } from 'astro:content';
import { getCategoryHreflang } from '../../../data/hreflang';

export { getStaticPaths } from '../../c/[slug].astro';

type Props = {
  games: CollectionEntry<'games'>[];
  tagName: string;
};

const { games, tagName } = Astro.props as Props;
const slug = Astro.params.slug!;
const hreflangLinks = getCategoryHreflang(slug);

const displayTagName = tagName
  .split(' ')
  .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
  .join(' ');

const gameCount = games.length;
const description = `在 FiddleBops 游戏世界中免费在线游玩 ${gameCount} 个 ${displayTagName} 相关游戏，包括 ${games
  .slice(0, 3)
  .map((g) => g.data.title.split(' - ')[0])
  .join('、')} 等。`;
const title = `${displayTagName} 游戏 - FiddleBops 游戏世界`;
const canonicalUrl = `https://www.playfiddlebops.com/zh/c/${slug}/`;

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'ItemList',
  name: title,
  description,
  url: canonicalUrl,
  itemListElement: games.map((game, index) => ({
    '@type': 'ListItem',
    position: index + 1,
    url: `https://www.playfiddlebops.com/zh/${game.data.urlstr ?? game.slug}/`
  }))
};
---
<BaseLayout
  title={title}
  description={description}
  canonicalUrl={canonicalUrl}
  jsonLd={jsonLd}
  hreflangLinks={hreflangLinks}
  lang="zh-CN"
>
  <section class="games">
    <div class="container">
      <h1>{displayTagName} 游戏</h1>
      <p>
        一共 {gameCount} 个与 {displayTagName} 相关的免费在线游戏，随时点开即可游玩。
      </p>
      <div class="game-grid">
        {games.map((game) => {
          const url = `/zh/${game.data.urlstr ?? game.slug}/`;
          const gameTitle = game.data.title.split(' - ')[0];
          return (
            <article class="game">
              <a href={url}>
                <div class="game-logo">
                  <img
                    src={game.data.thumbnail}
                    alt={gameTitle}
                    loading="lazy"
                    width="300"
                    height="300"
                  />
                </div>
                <p>{gameTitle}</p>
              </a>
            </article>
          );
        })}
      </div>
    </div>
  </section>

  <CATEGORIES lang="zh-CN" />
</BaseLayout>
