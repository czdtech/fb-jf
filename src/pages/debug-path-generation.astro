---
import { getCollection } from "astro:content";
import { generateLanguageSlug } from "@/utils/i18n";

console.log("üîç Debugging generateAllLocalesGamePaths logic...");

const allGames = await getCollection("games");
console.log(`Total games: ${allGames.length}`);

// Debug language grouping logic
const SUPPORTED_LOCALES = ['en', 'zh', 'es', 'fr', 'de', 'ja', 'ko'];
const gamesByLocale = {};
const englishGames = [];

for (const game of allGames) {
  const gameId = game.id.replace(/\.md$/, "");
  
  // Check if it's a non-English game (starts with language code)
  const languageMatch = SUPPORTED_LOCALES.find(lang => lang !== "en" && gameId.startsWith(`${lang}-`));
  
  if (languageMatch) {
    // Multi-language game: {locale}-{slug}
    if (!gamesByLocale[languageMatch]) {
      gamesByLocale[languageMatch] = [];
    }
    gamesByLocale[languageMatch].push(game);
  } else {
    // English game: {slug}
    englishGames.push(game);
  }
}

console.log(`\nüìä Games by locale:`);
console.log(`English games: ${englishGames.length}`);
Object.keys(gamesByLocale).forEach(locale => {
  console.log(`${locale} games: ${gamesByLocale[locale].length}`);
});

// Test path generation for Chinese specifically
console.log(`\nüîç Testing path generation for Chinese...`);
const locale = 'zh';
const localeGames = gamesByLocale[locale] || [];

// Look for English ayocs-sprunkr
const englishAyocs = englishGames.find(g => g.data.slug === 'ayocs-sprunkr');
if (englishAyocs) {
  console.log(`Found English ayocs: ID="${englishAyocs.id}", slug="${englishAyocs.data.slug}"`);
  
  const baseSlug = englishAyocs.data.slug;
  const targetSlug = generateLanguageSlug(baseSlug, locale);
  console.log(`Base slug: "${baseSlug}" ‚Üí Target slug: "${targetSlug}"`);
  
  const localizedGame = localeGames.find(game => {
    console.log(`  Checking Chinese game: ID="${game.id}", slug="${game.data.slug}" === "${targetSlug}" ? ${game.data.slug === targetSlug}`);
    return game.data.slug === targetSlug;
  });
  
  if (localizedGame) {
    console.log(`‚úÖ Found localized Chinese game: "${localizedGame.id}"`);
    console.log(`Would generate path: /zh/ayocs-sprunkr/ using content from ${localizedGame.id}`);
  } else {
    console.log(`‚ùå No localized Chinese game found, would use English fallback`);
    console.log(`Would generate path: /zh/ayocs-sprunkr/ using content from ${englishAyocs.id}`);
  }
} else {
  console.log(`‚ùå English ayocs-sprunkr not found`);
}
---

<html>
<head>
  <title>Path Generation Debug</title>
</head>
<body>
  <h1>Path Generation Debug</h1>
  <p>Check the console for debug output during build</p>
</body>
</html>