---
import { Image } from 'astro:assets';
import OptimizedImage from './OptimizedImage.astro';
import { getLocaleFromLangAttr, getLocalizedPath } from '../i18n/utils';

interface Props {
  title: string;
  thumbnail: string;
  slug: string;
  description?: string;
  loading?: 'lazy' | 'eager';
  lang?: string;
}

const { title, thumbnail, slug, description, loading = 'lazy', lang = 'en' } = Astro.props;
const locale = getLocaleFromLangAttr(lang);
const href = getLocalizedPath(`${slug}/`, locale);

// Determine if thumbnail is a local or remote image
const isRemote = thumbnail.startsWith('http://') || thumbnail.startsWith('https://');
const isAbsolutePath = thumbnail.startsWith('/');

// For local images, we need to handle them differently
// Remote images: use plain img
// Absolute paths (public folder): use OptimizedImage for WebP support
// Relative paths (src folder): use Astro Image for build-time optimization
---

<div class="game game--compact">
  <a href={href} title={title}>
    <div class="game-logo game-l-2">
      {isRemote ? (
        <img 
          src={thumbnail} 
          alt={title} 
          loading={loading}
          width="300"
          height="169"
        />
      ) : isAbsolutePath ? (
        <OptimizedImage 
          src={thumbnail} 
          alt={title} 
          loading={loading}
          width={300}
          height={169}
        />
      ) : (
        <Image 
          src={thumbnail} 
          alt={title} 
          loading={loading}
          width={300}
          height={169}
          format="webp"
        />
      )}
      <div class="game-overlay">
        <p>{title}</p>
      </div>
    </div>
  </a>
</div>
