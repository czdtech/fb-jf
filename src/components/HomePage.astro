---
/**
 * HomePage Template Component
 *
 * Goal: unify all locale homepages to the same layout + script initialization.
 * - Uses BaseLayout (which injects Header/Footer/SEO/Analytics)
 * - Uses i18n JSON for UI strings (same approach as ui-i18n-cards)
 *
 * Requirements: R3, R4
 */
	import BaseLayout from '../layouts/BaseLayout.astro';
	import GameSidebar from './GameSidebar.astro';
	import IndexTrendingGames from './IndexTrendingGames.astro';
	import Common from './Common.astro';
	import Categories from './Categories.astro';
	import SoundCard from './SoundCard.astro';
	import LongContentDe from './homepage/HomePageLongContent.de.astro';
	import LongContentEn from './homepage/HomePageLongContent.en.astro';
	import LongContentEs from './homepage/HomePageLongContent.es.astro';
	import LongContentFr from './homepage/HomePageLongContent.fr.astro';
	import LongContentJa from './homepage/HomePageLongContent.ja.astro';
	import LongContentKo from './homepage/HomePageLongContent.ko.astro';
	import LongContentZh from './homepage/HomePageLongContent.zh.astro';
	import { HOMEPAGE_SOUNDS } from '../data/sounds';
	import { getLocaleFromLangAttr, useTranslations, type Locale } from '../i18n/utils';

interface Props {
  /**
   * HTML lang attribute value for this page.
   * Examples: "en", "zh-CN", "de", "fr", "es", "ja", "ko"
   */
  lang?: string;
}

const { lang = 'en' } = Astro.props as Props;
const locale = getLocaleFromLangAttr(lang);
const t = useTranslations(locale);

const SEO_COPY: Record<Locale, { title: string; description: string }> = {
  en: {
    title: 'FiddleBops - Play FiddleBops Incredibox Game',
    description:
      'Create your unique music with Fiddlebops! This fan-made project, inspired by Incredibox, lets you mix and match various sounds to compose personalized tracks.',
  },
  zh: {
    title: 'Fiddlebops - 免费在线Fiddlebops Incredibox游戏',
    description:
      '用 Fiddlebops 创建你独一无二的音乐！这是一个受 Incredibox 启发的粉丝自制项目，允许你混合搭配各种声音，创作个性化音乐。在 Fiddlebops 中，探索你的音乐天赋，分享你的独特音乐。',
  },
  de: {
    title: 'Fiddlebops - Kostenloses Online Fiddlebops Incredibox Spiel',
    description:
      'Erstelle deine einzigartige Musik mit Fiddlebops! Dieses Fanprojekt, inspiriert von Incredibox, ermöglicht es dir, verschiedene Sounds zu mischen und zu kombinieren, um personalisierte Musikstücke zu erstellen.',
  },
  fr: {
    title: 'Fiddlebops - Jeu Fiddlebops Incredibox en ligne gratuit',
    description:
      "Créez votre musique unique avec Fiddlebops ! Ce projet de fans inspiré d'Incredibox vous permet de mélanger et d'associer différents sons pour composer des morceaux personnalisés.",
  },
  es: {
    title: 'Fiddlebops - Juego Gratuito en Línea Fiddlebops Incredibox',
    description:
      '¡Crea tu música única con Fiddlebops! Este proyecto hecho por fans, inspirado en Incredibox, te permite mezclar y combinar varios sonidos para componer pistas personalizadas.',
  },
  ja: {
    title: 'Fiddlebops - 無料オンラインFiddlebops Incrediboxゲーム',
    description:
      'Fiddlebopsであなただけの音楽を創りましょう！Incrediboxにインスパイアされたファン制作のプロジェクトで、様々なサウンドをミックスしてパーソナライズされた音楽を作成できます。',
  },
  ko: {
    title: 'Fiddlebops - 무료 온라인 Fiddlebops Incredibox 게임',
    description:
      '피들봅스로 나만의 독특한 음악을 만들어 보세요! 인크레디박스에서 영감을 받은 팬 제작 프로젝트로, 다양한 사운드를 믹스 매치하여 개성 있는 음악을 작곡할 수 있습니다.',
  },
};

const title = SEO_COPY[locale].title;
const description = SEO_COPY[locale].description;
const canonicalUrl = locale === 'en' ? 'https://www.playfiddlebops.com/' : `https://www.playfiddlebops.com/${locale}/`;

const jsonLd = {
  '@context': 'https://schema.org',
  '@type': 'Game',
  name: title,
  alternateName: 'playfiddlebops.com',
  url: canonicalUrl,
  description,
};

// Keep hreflang tags consistent across all homepage versions.
const hreflangLinks = [
  { lang: 'x-default', url: 'https://www.playfiddlebops.com/' },
  { lang: 'en', url: 'https://www.playfiddlebops.com/' },
  { lang: 'zh-CN', url: 'https://www.playfiddlebops.com/zh/' },
  { lang: 'de', url: 'https://www.playfiddlebops.com/de/' },
  { lang: 'fr', url: 'https://www.playfiddlebops.com/fr/' },
  { lang: 'es', url: 'https://www.playfiddlebops.com/es/' },
  { lang: 'ja', url: 'https://www.playfiddlebops.com/ja/' },
  { lang: 'ko', url: 'https://www.playfiddlebops.com/ko/' },
];

const showEmail = locale === 'en';

// Legacy long-form homepage sections (about/games/video/faq) preserved per locale.
// Enabled for locales with preserved long-form text to avoid SEO/UX drift.
const LONG_CONTENT_BY_LOCALE: Partial<Record<Locale, any>> = {
  en: LongContentEn,
  de: LongContentDe,
  es: LongContentEs,
  fr: LongContentFr,
  ja: LongContentJa,
  ko: LongContentKo,
  zh: LongContentZh,
};

const LongContent = LONG_CONTENT_BY_LOCALE[locale];
---

<BaseLayout
  title={title}
  description={description}
  canonicalUrl={canonicalUrl}
  ogImage="https://www.playfiddlebops.com/tw.jpg"
  ogType="website"
  twitterCard="summary_large_image"
  jsonLd={jsonLd}
  hreflangLinks={hreflangLinks}
  lang={lang}
  additionalStyles={['/styles/homepage.css']}
  showHeader={true}
  showFooter={true}
  showEmail={showEmail}
>
  <section class="hero">
    <div class="container">
      <div class="game-card">
        <div class="game-info" id="paly">
          <h2>{t('common.welcomeTitle', 'Welcome to Fiddlebops Incredibox!')}</h2>
          <p>{t('common.welcomeDescription', 'Start your musical journey!')}</p>
        </div>

        <GameSidebar lang={lang} kind="popular" />
        <div class="game-iframe-sprunki">
          <iframe id="fiddlebops-iframe" src="about:blank" allowtransparency="true" allowfullscreen width="800" height="450" loading="lazy"></iframe>
          <a
            id="playButton"
            href="https://fiddlebops-49o.pages.dev/"
            target="_blank"
            rel="noopener noreferrer"
          >
            {t('game.play', 'Play')}
          </a>
        </div>
        <GameSidebar lang={lang} kind="new" />
      </div>
    </div>
  </section>
  <IndexTrendingGames lang={lang} />
  <Common lang={lang} />
  <Categories lang={lang} />

  {LongContent ? (
    <LongContent />
  ) : (
    <Fragment>
      <section class="about" id="about">
        <div class="container">
          <h2>{t('homepage.aboutTitle', 'About Fiddlebops Incredibox')}</h2>
          <div class="about-content">
            <p>{description}</p>
          </div>
        </div>
      </section>

	      <section class="games">
	        <div class="container">
	          <h2>{t('homepage.exploreSoundsTitle', 'Explore the Different Sounds in Fiddlebops Incredibox')}</h2>
	          <div class="game-grid">
	            {HOMEPAGE_SOUNDS.map((sound) => (
	              <SoundCard title={sound.title} imageSrc={sound.imageSrc} audioSrc={sound.audioSrc} />
	            ))}
	          </div>
	        </div>
	      </section>

      <section class="game-video about">
        <div class="container">
          <h2>{t('homepage.videoTitle', 'Fiddlebops Incredibox Game Video')}</h2>
          <div class="video-container">
            <iframe
              src="https://www.youtube.com/embed/4Oj-dVLSA70"
              title="Fiddlebops ALL POLOS 4K (WITH SUBTITLES)"
              loading="lazy"
              width="560"
              height="315"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen
            ></iframe>
            <iframe
              src="https://www.youtube.com/embed/JlMa-fRBOwE"
              title="Every Incredibox Fiddlebops in 8 Minutes"
              loading="lazy"
              width="560"
              height="315"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture;"
              allowfullscreen
            ></iframe>
            <div class="clear-both"></div>
          </div>
        </div>
        <div class="clear-both"></div>
      </section>
    </Fragment>
  )}

  <!-- Iframe loader script for homepage game -->
  <script>
    import { initIframeLoader } from '../scripts/iframe-loader.ts';

    initIframeLoader({
      iframeId: 'fiddlebops-iframe',
      playButtonId: 'playButton',
      containerSelector: '.game-iframe-sprunki',
      iframeSrc: 'https://fiddlebops-49o.pages.dev/'
    });
  </script>
</BaseLayout>
