---
import GameCard from '@/components/GameCard.astro'
import { getTranslation } from '@/i18n/utils'
import { getRelativeLocaleUrl } from 'astro:i18n'

interface Props {
  games: {
    trending: any[]
    popular: any[]
    new: any[]
  }
  currentGameSlug?: string
}

const { games, currentGameSlug } = Astro.props

// 获取当前语言和翻译 - 使用Astro官方i18n系统
const currentLocale = (Astro.currentLocale as any) || 'en'
const { ui } = await getTranslation(currentLocale)

// 从所有游戏中选择相关游戏，排除当前游戏
const allGames = [...games.trending, ...games.popular, ...games.new].filter(
  (game: any) => game.slug !== currentGameSlug
)

// 随机选择6个相关游戏
const relatedGames = allGames.sort(() => Math.random() - 0.5).slice(0, 6)
---

<section class="game-related-section scroll-animate">
  <div class="container">
    <div class="section-header music-element hero-music-delay-35">
      <h2 class="section-title">
        <i class="fas fa-gamepad"></i>
        {ui?.sections?.relatedGames || '相关游戏'}
      </h2>
      <p class="section-subtitle">{ui?.sections?.relatedGamesDesc || '发现更多惊人的音乐创作游戏'}</p>
      <a href={getRelativeLocaleUrl(currentLocale, '/games/')} class="view-all-btn">
        <span>{ui?.games?.viewAllGames || '查看所有游戏'}</span>
        <i class="fas fa-arrow-right"></i>
      </a>
    </div>

    <div class="grid gap-4 md:gap-5 lg:gap-6 xl:gap-8 grid-cols-1 xs:grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 related-games-grid">
      {
        relatedGames.map((game, index) => (
          <div class={`game-item game-grid-item music-element hero-music-delay-${36 + index}`}>
            <GameCard game={game} variant="grid" />
          </div>
        ))
      }
    </div>
  </div>
</section>

<style>
  /* ==========================================================================
   Game Related Section
   ========================================================================== */

  .game-related-section {
    padding: var(--space-12) 0;
    position: relative;
  }

  .section-header {
    text-align: center;
    margin-bottom: var(--space-10);
  }

  .section-title {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-3);
    font-size: var(--font-size-3xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-gray-900);
    margin-bottom: var(--space-3);
    background: linear-gradient(
      135deg,
      var(--color-primary-600),
      var(--color-primary-700)
    );
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .section-title i {
    color: var(--color-primary-600);
    background: none;
    -webkit-text-fill-color: var(--color-primary-600);
  }

  .section-subtitle {
    font-size: var(--font-size-lg);
    color: var(--color-gray-600);
    margin-bottom: var(--space-6);
  }

  .view-all-btn {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-6);
    background: var(--hero-sidebar-glass-bg);
    backdrop-filter: var(--hero-sidebar-glass-blur);
    -webkit-backdrop-filter: var(--hero-sidebar-glass-blur);
    border: var(--hero-sidebar-glass-border);
    border-radius: var(--border-radius-full);
    color: var(--color-primary-600);
    font-weight: var(--font-weight-semibold);
    text-decoration: none;
    transition: all var(--duration-300) var(--ease-in-out);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
  }

  .view-all-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 32px rgba(147, 51, 234, 0.2);
    color: var(--color-primary-700);
  }

  .view-all-btn i {
    transition: transform var(--duration-200) var(--ease-in-out);
  }

  .view-all-btn:hover i {
    transform: translateX(4px);
  }

  /* 游戏网格样式现在由统一的 game-grids.css 提供 */
  .related-games-grid {
    max-width: 1400px;
    margin: 0 auto;
  }

  .game-item {
    height: 100%;
  }

  /* 响应式设计 */
  @media (max-width: 768px) {
    .game-related-section {
      padding: var(--space-10) 0;
    }

    .section-title {
      font-size: var(--font-size-2xl);
      flex-direction: column;
      gap: var(--space-2);
    }

    .section-subtitle {
      font-size: var(--font-size-base);
    }
  }

  @media (max-width: 480px) {
    .related-games-grid {
      grid-template-columns: 1fr;
      gap: var(--space-3);
    }
  }
</style>
