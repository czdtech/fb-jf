---
/**
 * Header Component
 * Site header with navigation and language selector
 * 
 * Requirements: 2.1, 4.4, 4.5
 */

import { useTranslations, getLocaleFromLangAttr } from '../i18n/utils';

interface Props {
  lang?: string;
}

const { lang = 'en' } = Astro.props as Props;

const locale = getLocaleFromLangAttr(lang);
const t = useTranslations(locale);

const LANGUAGE_PREFIXES: Record<string, string> = {
  'en': '',
  'zh-CN': '/zh',
  'es': '/es',
  'fr': '/fr',
  'de': '/de',
  'ja': '/ja',
  'ko': '/ko'
};

const prefix = LANGUAGE_PREFIXES[lang] ?? '';
const withPrefix = (path: string) => `${prefix}${path}`;
---

<header>
    <div class="container">
        <div class="logo">
            <h1><a href={withPrefix('/')}>Fiddle<span class="light">Bops</span></a></h1>
        </div>
        <button class="nav-toggle" aria-label="Toggle Navigation">☰</button>
        <nav class="nav-menu">
            <ul>
                <li><a href={withPrefix('/')}>{t('nav.home', 'Home')}</a></li>
                <li><a href={withPrefix('/update-games/')}>{t('nav.newGames', 'New Games')}</a></li>
                <li><a href={withPrefix('/fiddlebops-mod/')}>{t('nav.fiddlebopsMod', 'Fiddlebops Mod')}</a></li>
                <li><a href={withPrefix('/incredibox-mod/')}>{t('nav.incrediboxMod', 'Incredibox Mod')}</a></li>
                <li><a href={withPrefix('/sprunki-mod/')}>{t('nav.sprunkiMod', 'Sprunki Mod')}</a></li>
            </ul>
        </nav>
        <select class="language-select">
            <option data-lang="en" data-url="/">English</option>
            <option data-lang="zh-CN" data-url="/zh/">简体中文</option>  
            <option data-lang="es" data-url="/es/">Español</option>
            <option data-lang="fr" data-url="/fr/">Français</option>
            <option data-lang="de" data-url="/de/">Deutsch</option>
            <option data-lang="ja" data-url="/ja/">日本語</option>
            <option data-lang="ko" data-url="/ko/">한국어</option>
        </select>
    </div>
</header>

<script>
  import { initNavToggle, initLanguageSwitcher } from '../scripts/index.ts';
  
  // Initialize nav toggle for mobile navigation
  initNavToggle({
    toggleSelector: '.nav-toggle',
    menuSelector: '.nav-menu'
  });
  
  // Initialize language switcher
  initLanguageSwitcher({
    selectSelector: '.language-select'
  });
</script>
