---
/**
 * Header Component
 * Site header with navigation and language selector
 * 
 * Requirements: 2.1, 4.4, 4.5
 */

import { useTranslations, getLocaleFromLangAttr, getLocalizedPath } from '../i18n/utils';

interface Props {
  lang?: string;
}

const { lang = 'en' } = Astro.props as Props;

const locale = getLocaleFromLangAttr(lang);
const t = useTranslations(locale);
const withLocale = (path: string) => getLocalizedPath(path, locale);
---

<header>
    <div class="container">
        <div class="logo">
            <h1><a href={withLocale('/')}>Fiddle<span class="light">Bops</span></a></h1>
        </div>
        <button class="nav-toggle" aria-label="Toggle Navigation">
            <svg class="nav-icon nav-icon-open" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
            </svg>
            <svg class="nav-icon nav-icon-close" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
        </button>
        <nav class="nav-menu">
            <ul>
                <li><a href={withLocale('/')}>{t('nav.home', 'Home')}</a></li>
                <li><a href={withLocale('/update-games/')}>{t('nav.newGames', 'New Games')}</a></li>
                <li class="nav-dropdown">
                    <button class="nav-dropdown-toggle" aria-expanded="false" aria-haspopup="true">
                        {t('nav.mods', 'Mods')}
                        <svg class="dropdown-arrow" width="12" height="12" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                            <path d="M7 10l5 5 5-5z"/>
                        </svg>
                    </button>
                    <ul class="nav-dropdown-menu">
                        <li><a href={withLocale('/fiddlebops-mod/')}>{t('nav.fiddlebopsMod', 'Fiddlebops Mod')}</a></li>
                        <li><a href={withLocale('/incredibox-mod/')}>{t('nav.incrediboxMod', 'Incredibox Mod')}</a></li>
                        <li><a href={withLocale('/sprunki-mod/')}>{t('nav.sprunkiMod', 'Sprunki Mod')}</a></li>
                    </ul>
                </li>
                <li><a href={withLocale('/search/')}>{t('nav.search', 'Search')}</a></li>
            </ul>
        </nav>
        <select class="language-select">
            <option data-lang="en" data-url="/">English</option>
            <option data-lang="zh-CN" data-url="/zh/">简体中文</option>  
            <option data-lang="es" data-url="/es/">Español</option>
            <option data-lang="fr" data-url="/fr/">Français</option>
            <option data-lang="de" data-url="/de/">Deutsch</option>
            <option data-lang="ja" data-url="/ja/">日本語</option>
            <option data-lang="ko" data-url="/ko/">한국어</option>
        </select>
    </div>
</header>

<script>
  import { initNavToggle, initLanguageSwitcher, initNavDropdown } from '../scripts/index.ts';
  
  // Initialize nav toggle for mobile navigation
  initNavToggle({
    toggleSelector: '.nav-toggle',
    menuSelector: '.nav-menu'
  });
  
  // Initialize language switcher
  initLanguageSwitcher({
    selectSelector: '.language-select'
  });

  // Initialize dropdown menu (uses global sentinel to prevent duplicate document listeners)
  initNavDropdown();
</script>
