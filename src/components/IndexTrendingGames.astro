---
// 1. 从我们的"数据库"中导入所有游戏
import { allGames } from '../data/games.js';
import { useTranslations, getLocaleFromLangAttr, getLocalizedPath } from '../i18n/utils';

interface Props {
  lang?: string;
}

const { lang = 'en' } = Astro.props as Props;
const locale = getLocaleFromLangAttr(lang);
const t = useTranslations(locale);

// 2. 定义要随机显示的游戏数量
const numberOfGamesToShow = 12; // 例如，随机显示12个

// 3. 随机化并挑选游戏的核心逻辑
//    这段代码会在网站构建时运行
const shuffledGames = allGames.sort(() => 0.5 - Math.random());
const randomGames = shuffledGames.slice(0, numberOfGamesToShow);
---

<section class="games">
     <div class="container">
       <h2>{t('game.trendingGames', 'Trending Games')}</h2>
       <div class="game-grid">

            <div class="game game--compact">
              <a href={getLocalizedPath('steal-a-brainrot/', locale)} title="Steal a Brainrot">
                 <div class="game-logo game-l-2">
                     <img
                       src="/new-images/steal-a-brainrot.webp"
                       alt="Steal a Brainrot"
                       loading="lazy"
                       width="300"
                       height="300"
                     />
                 </div>
                 <p class="game__title--ellipsis">Steal a Brainrot</p>
              </a>
            </div>

            <div class="game game--compact">
              <a href={getLocalizedPath('99-nights-in-the-forest/', locale)} title="99 Nights in the Forest">
                 <div class="game-logo game-l-2">
                     <img
                       src="/new-images/99-nights-in-the-forest.webp"
                       alt="99 Nights in the Forest"
                       loading="lazy"
                       width="300"
                       height="300"
                     />
                 </div>
                 <p class="game__title--ellipsis">99 Nights in the Forest</p>
              </a>
            </div>

            <div class="game game--compact">
              <a href={getLocalizedPath('grow-a-garden/', locale)} title="Grow a Garden">
                 <div class="game-logo game-l-2">
                     <img
                       src="/growagarden-min.jpeg"
                       alt="Grow a Garden"
                       loading="lazy"
                       width="300"
                       height="300"
                     />
                 </div>
                 <p class="game__title--ellipsis">Grow a Garden</p>
              </a>
            </div>

         {randomGames.map(({ astronaut }) => (
            <div class="game game--compact">
              <a href={getLocalizedPath(astronaut[0].replace(/^\/+/, '').replace(/\/+$/, '') + '/', locale)} title={astronaut[2]}>
                 <div class="game-logo game-l-2">
                     <img
                       src={astronaut[1]}
                       alt={astronaut[2]}
                       loading="lazy"
                       width="300"
                       height="300"
                     />
                 </div>
                 <p class="game__title--ellipsis">{astronaut[2]}</p>
              </a>
            </div>
         ))}
       </div>
                 <div class="more"><a href={getLocalizedPath('update-games/', locale)}>{t('game.exploreGames', 'More Games')}</a></div>
            </div>
        </section>
