# Decap CMS Configuration
# 文档: https://decapcms.org/docs/

backend:
  name: github
  repo: czdtech/fb-jf
  branch: main
  # 性能优化：使用 GitHub GraphQL 批量拉取文件列表/内容，减少 REST API 请求数
  use_graphql: true
  # GitHub OAuth scope：public repo 写入权限（比 repo 更小更安全）
  auth_scope: public_repo
  # 这里不是你的网站域名，而是 OAuth 代理服务（Worker）的域名
  # 先用 workers.dev 跑通；后续绑定自定义域名后再改成 https://auth.playfiddlebops.com
  base_url: https://wispy-queen-45cf.chongzhidatech.workers.dev
  auth_endpoint: auth

# 媒体文件存储位置
media_folder: "public/new-images"
public_folder: "/new-images"

# 本地开发时使用（需要运行：npx decap-server）
# local_backend: true

# 集合定义
collections:
  - name: "games"
    label: "游戏"
    folder: "src/content/games"
    create: true
    # 强绑定：文件名使用 urlstr（会生成 `<urlstr>.en.md`）
    slug: "{{fields.urlstr}}"
    # 性能优化：仓库里总共有 7 语言版本（约 679*7=4753 个文件）。
    # Decap 的 GitHub backend 会为列表视图拉取并解析大量文件，导致后台“加载不出来”。
    # 这里将 canonical 英文文件统一命名为 `*.en.md`，并让 CMS 只索引该扩展名。
    extension: "en.md"
    format: "frontmatter"
    fields:
      - { label: "标题", name: "title", widget: "string", required: true }
      - { label: "描述", name: "description", widget: "text", required: true }
      - { label: "游戏链接", name: "iframeSrc", widget: "string", required: true }
      - { label: "缩略图", name: "thumbnail", widget: "image", required: true }
      - label: "URL 路径（唯一）"
        name: "urlstr"
        widget: "string"
        required: true
        hint: "创建后尽量不要修改（与文件名、页面路径强绑定）"
        pattern: ["^[a-z0-9]+(?:-[a-z0-9]+)*$", "只能使用小写字母、数字和连字符（-），例如：sprunki-phase-8"]
      - { label: "标签", name: "tags", widget: "list", required: true }
      - { label: "语言", name: "locale", widget: "hidden", default: "en" }
      - label: "Mod 类型"
        name: "modType"
        widget: "select"
        required: false
        options: ["sprunki", "incredibox", "fiddlebops"]
      - { label: "精选（Featured）", name: "featured", widget: "boolean", required: false, default: false }
      - { label: "侧栏 - New 位（1-4）", name: "sidebarNew", widget: "number", required: false, min: 1, max: 4, step: 1 }
      - { label: "侧栏 - Popular 位（1-4）", name: "sidebarPopular", widget: "number", required: false, min: 1, max: 4, step: 1 }
      - { label: "发布日期", name: "releaseDate", widget: "datetime", required: false, format: "YYYY-MM-DD", time_format: false, picker_utc: true }
      - { label: "评分", name: "score", widget: "string", required: false }
      - { label: "开发者", name: "developer", widget: "string", required: false }

  - name: "trending"
    label: "Trending 配置"
    files:
      - name: "trending"
        label: "Trending Games"
        file: "src/data/trending.json"
        format: "json"
        fields:
          - { label: "generatedAt", name: "generatedAt", widget: "datetime", required: false }
          - { label: "window", name: "window", widget: "string", required: false }
          - { label: "source", name: "source", widget: "string", required: false }
          - label: "Trending 游戏列表"
            name: "items"
            widget: "list"
            fields:
              - { label: "Slug", name: "slug", widget: "string" }
              - { label: "Score（热度/浏览量）", name: "score", widget: "number", required: true }
