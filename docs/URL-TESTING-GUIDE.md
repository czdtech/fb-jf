# URL Testing Solution - 使用说明

## 快速开始

### 1. 运行基础验证
```bash
node run-url-test.mjs
```
这会快速测试6个关键URL，检查语言内容是否匹配。

### 2. 运行完整测试套件
```bash
node playwright-mcp-tester.mjs
```
完整测试13种URL类型，包含详细的检查项目。

### 3. 检查配置
查看 `test-url-config.mjs` 了解所有测试的URL和预期内容。

## 文件说明

### 核心测试文件
- **`run-url-test.mjs`** - 主要执行器，简单快速的验证
- **`playwright-mcp-tester.mjs`** - 完整测试套件，详细报告
- **`test-url-config.mjs`** - 测试配置，定义13种URL类型

### 开发文件
- **`test-with-mcp.mjs`** - MCP工具集成示例
- **`url-tester.mjs`** - 高级测试功能实现

## 检查项目

### 语言匹配
- ✅ 英文页面显示英文内容
- ✅ 中文页面显示中文内容
- ❌ 检测语言不匹配问题

### 内容验证
- 页面标题正确性
- 导航元素存在
- 游戏数量准确性
- 表单和搜索功能

### URL类型覆盖
1. 主页 (`/`, `/zh/`)
2. 游戏列表 (`/games/`, `/zh/games/`)
3. 游戏详情页
4. 分页列表
5. 分类页面
6. 搜索功能
7. 关于/联系页面
8. 404错误页

## 典型问题及解决方案

### 问题1：中文页面显示英文内容
**症状：** 访问 `/zh/games/` 但看到英文标题和内容
**解决：** 检查 `src/utils/i18n.ts` 中的内容加载逻辑

### 问题2：游戏计数错误
**症状：** 游戏列表页显示0个游戏
**解决：** 检查 `getLocalizedGamesList()` 函数

### 问题3：导航失败
**症状：** 页面无法访问或返回404
**解决：** 检查Astro路由配置和服务器状态

## 运行前提条件

1. **服务器运行：** 确保 `localhost:4321` 可访问
   ```bash
   npm run dev  # 或 astro dev
   ```

2. **依赖安装：** Node.js 和项目依赖已安装

3. **内容文件：** 确保中文游戏内容文件存在

## 自定义配置

编辑 `test-url-config.mjs` 来：
- 添加新的URL测试
- 修改预期内容检查
- 调整超时和重试设置
- 自定义移动端视口大小

## 集成到CI/CD

将测试集成到自动化流程：
```bash
# 在部署前运行
npm run build
npm run preview &  # 启动预览服务器
sleep 5  # 等待服务器启动
node run-url-test.mjs  # 运行验证
```

## Linus Torvalds 哲学体现

1. **解决真实问题** - 专注检测实际的语言不匹配问题
2. **简单直接** - 避免过度设计，直接验证核心功能
3. **实用主义** - 提供可操作的错误报告和修复建议
4. **零破坏性** - 只读测试，不修改任何现有代码

## 故障排除

### 测试失败时的检查清单
1. [ ] 服务器是否在 localhost:4321 运行？
2. [ ] 页面是否正常加载？
3. [ ] 中文内容文件是否存在？
4. [ ] i18n配置是否正确？
5. [ ] Astro构建是否成功？

### 常见错误信息
- `"Navigation timeout"` - 检查服务器状态
- `"Language mismatch"` - 检查内容本地化
- `"No games found"` - 检查游戏数据加载

---

**提示：** 先运行 `run-url-test.mjs` 进行快速验证，如果发现问题再用 `playwright-mcp-tester.mjs` 进行详细分析。